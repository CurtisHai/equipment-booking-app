{% extends 'bookings/base.html' %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-center mb-4">Admin Message Inbox</h2>

    <!-- Unsettled messages section -->
    <h3 class="mb-3" style="color: #BE02F8;">Unsettled Messages</h3>
    {% if unsettled_messages %}
        <form method="POST">
            {% csrf_token %}
            <div class="table-responsive">
                <table class="table table-striped table-bordered table-hover w-150" style="background-color: #BEDAE5; width: 100%;">
                    <thead style="background-color: #BE02F8; color: #192d38; font-size: 1.25rem;">
                        <tr class="text-center">
                            <th>Subject</th>
                            <th>Confirmation Number</th>
                            <th>Sender Email</th>
                            <th>Message</th>
                            <th>Status</th>
                            <th>Mark as Replied</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for message in unsettled_messages %}
                        <tr class="text-center">
                            <td>{{ message.subject|default:"No Subject Provided" }}</td>
                            <td>{{ message.confirmation_number|stringformat:"s"|slice:":8" }}</td>
                            <td>{{ message.sender.email }}</td>
                            <td>{{ message.content }}</td>
                            <td>{{ message.read|yesno:"Read,Unread" }}</td>
                            <td><input type="checkbox" name="replied_messages" value="{{ message.id }}"></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <button type="submit" class="btn btn-primary mt-3">Mark as Replied</button>
        </form>
    {% else %}
        <p>No unsettled messages.</p>
    {% endif %}

    <!-- Settled messages section -->
    <h3 class="mt-5 mb-3" style="color: #BE02F8;">Settled Messages</h3>
    {% if settled_messages %}
        <div class="table-responsive">
            <table class="table table-striped table-bordered table-hover w-100" style="background-color: #BEDAE5; width: 100%;">
                <thead style="background-color: #BE02F8; color: #192d38; font-size: 1.25rem;">
                    <tr class="text-center">
                        <th>Subject</th>
                        <th>Confirmation Number</th>
                        <th>Sender Email</th>
                        <th>Message</th>
                        <th>Responded By</th>
                    </tr>
                </thead>
                <tbody>
                    {% for message in settled_messages %}
                    <tr class="text-center">
                        <td>{{ message.subject|default:"No Subject Provided" }}</td>
                        <td>{{ message.confirmation_number|stringformat:"s"|slice:":8" }}</td>
                        <td>{{ message.sender.email }}</td>
                        <td>{{ message.content }}</td>
                        <td>
                            {% if message.responded_by %}
                                {{ message.responded_by.username }}
                            {% else %}
                                Unknown
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p>No settled messages.</p>
    {% endif %}
</div>
{% endblock %}
